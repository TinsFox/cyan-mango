<navBar navColor="#18b3eb" title="我的成绩"></navBar>

<view class='cu-load load-modal' wx:if="{{loading}}">
	<view class='cuIcon-emojifill text-orange'></view>
	<view class='gray-text'>同步中...</view>
</view>

<view class='page'>
	

	<view hidden='{{hideSyncTip}}' style='color:grey;font-size:70%;margin:10rpx'>24:00后教务系统通道关闭，将无法同步</view>

<!-- 本学期成绩 -->
	<block wx:if="{{current_term}}">
  	<view class='sum-grade'>
		<image bindtap='updateGrade' class='updateIcon' animation="{{animation}}" mode='widthFix' src='https://shaw-1256261760.cos.ap-guangzhou.myqcloud.com/gzhu-pi/images/icon/reflesh.png'></image>
		<view style='flex:1'>{{grade.ave_point}}
			<view class='bottom-text'>平均绩点</view>
		</view>
		<view style='flex:1'>{{grade.ele_credit + grade.gen_credit + grade.req_credit}}
			<view class='bottom-text'>总学分</view>
		</view>
	</view>
		<view wx:if="{{grade}}" bindchange='swiperChange' style='height:{{height}}rpx'>
			<view  wx:key="index">
					<view class='sem-cell'>
						<view style='height:250rpx'>
							<view style='color:gray;padding:15rpx;font-size:110%'>{{grade.xnd}}学年 第{{grade.xqd}}学期</view>
							<view class='sem-grade'>
								<view style='flex:1'>{{grade.all_credit}}
									<view class='bottom-text'>已修学分</view>
								</view>

								<view style='flex:1'>{{grade.req_credit}}
									<view class='bottom-text'>学期绩点</view>
								</view>

							</view>
						</view>
						<!-- 课程成绩循环 --> 
							<view class='grade-cell' wx:for="{{grade.score}}">
							<view bindtap="showDetail" id="{{index}}">
							
									<view class='son-part part1'>
										<view style='flex:2.2'>{{item.class}}</view>
										<view style='flex:1;color:#18b3eb;'>{{item.score}}</view>
									</view>

									<view class='son-part part2'>
										<view style='flex:2.2'>学分：{{item.credit}}</view>
										<view style='flex:1'>绩点：{{item.score_point}}</view>
									</view>
							</view>
							</view>
						</view>
            <view>需要往年成绩？</view>
            <view bindtap="getExamHistory" class="box"> 》》》拉取数据《《《 </view>
			</view>
		</view>
	</block>
	<!-- 往年成绩 -->
	<block wx:else>
  <view class='sum-grade'>
		<image bindtap='updateGrade' class='updateIcon' animation="{{animation}}" mode='widthFix' src='https://shaw-1256261760.cos.ap-guangzhou.myqcloud.com/gzhu-pi/images/icon/reflesh.png'></image>
		<view style='flex:1'>{{ave_point}}
			<view class='bottom-text'>平均绩点</view>
		</view>
		<view style='flex:1'>{{all_credit}}
			<view class='bottom-text'>总学分</view>
		</view>
	</view>
	<view hidden='{{!hideSyncTip}}' style='color:grey;font-size:70%;margin:10rpx'>左右滑动切换学期</view>
		<swiper wx:if="{{grade}}" indicator-dots="{{true}}" bindchange='swiperChange' style='height:{{height}}rpx'>
			<view wx:for="{{grade}}" wx:for-item="sem_item" wx:for-index="sem_index" wx:key="index">
				<swiper-item>
					<view class='sem-cell'>
						<view style='height:250rpx'>
							<view style='color:gray;padding:15rpx;font-size:110%'>{{sem_item.xnd}}学年 第{{sem_item.xqd}}学期</view>
							<view class='sem-grade'>
								<view style='flex:1'>{{sem_item.all_credit}}
									<view class='bottom-text'>已修学分</view>
								</view>
								<view style='flex:1'>{{sem_item.req_credit}}
									<view class='bottom-text'>学期绩点</view>
								</view>
							</view>
						</view>

						<!-- 课程成绩循环 -->
						<view wx:for="{{sem_item.score}}" wx:key="index">
						<view bindtap="showDetail" id="{{index}}">
						
							<view class='grade-cell'>
								<view class='son-part part1'>
									<view style='flex:2.2'>{{item.class}}</view>
									<view style='flex:1;color:#18b3eb;'>{{item.score}}</view>
								</view>
								<view class='son-part part2'>
									<view style='flex:2.2'>学分：{{item.credit}}</view>
									<view style='flex:1'>绩点：{{item.score_point}}</view>
								</view>
							</view>
						</view>
						</view>

					</view>
				</swiper-item>
			</view>
		</swiper>
	</block>


	<!-- 无成绩数据 -->
	<view wx:if="{{!grade}}">
		<view class="text-center text-white" style='margin:200rpx 0'>
			<view>未查询到当前学期成绩数据</view>
			<view>可能教务系统未录入，请迟点再试！</view>
			<view>往年成绩</view>
			<view>↓↓↓↓↓</view>
			<view bindtap="getExamHistory"> 》》》拉取数据《《《 </view>
		</view>
	</view>

	<block wx:if="{{grade}}">
		<view style='color:grey;font-size:70%;margin:20rpx'>成绩数据仅供参考，请以官网为准</view>
	</block>
</view>

  <modal custom="true" show="{{showDetail}}" bind:cancel="cancelModal">
    <swiper bindchange="switchCourse" indicator-dots="{{detail.length>1?true:false}}" current="{{currentIndex}}" style='height:580rpx'>
      <swiper-item wx:for="{{detail}}" wx:key="index">
        <view class='course' style='background-color:{{tool.color(item.score,item.final_score)}}'>
          <view>{{item.class}}</view>
        </view>
        <view style='padding:10rpx'>
          <view class='detail-item solid-top'>
            <view class='key'>总评成绩</view>
            <view class='value'>{{item.score}}</view>
          </view>
          <view class='detail-item solid-top'>
            <view class='key'>绩点</view>
            <view class='value'>{{item.score_point}}</view>
          </view>
          <view class='detail-item solid-top'>
            <view class='key'>期末成绩</view>
            <view class='value'>{{item.final_score}}</view>
          </view>
          <view class='detail-item solid-top'>
            <view class='key'>平时成绩</view>
            <view class='value'>{{item.usual_score}}</view>
          </view>
          <view class='detail-item solid' wx:if="{{item.mid_score!=''}}">
            <view class='key'>期中考</view>
            <view class='value'>{{item.mid_score}}</view>
          </view>
          <view class='detail-item solid-top' wx:if="{{item.credit!=null}}">
            <view class='key'>学分</view>
            <view class='value'>{{item.credit}}</view>
          </view>
        </view>
      </swiper-item>
    </swiper>
  </modal>

	<wxs module="tool">
  
  var color = function(zp, qm){

  }
  module.exports = {
    color: color
  }
</wxs>
	