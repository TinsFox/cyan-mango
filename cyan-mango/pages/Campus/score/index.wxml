<wxs src="tools.wxs" module="tool" />
<navBar title="我的成绩"></navBar>
<loading loading="{{loading}}" text="数据加载中..."></loading>
<!-- 悬浮图标 -->

<view bindtap='showItem'>
	<button>
		<image  class='float-icon' mode='aspectFit' src='cloud://rc-qrqw6.7263-rc-qrqw6-1259627191/images/学年.svg'></image>
	</button>
</view>
<template name="itemList">
  <view class="cu-bar bg-white solid-bottom margin-top-xl animation-slide-bottom ">
    <view class="padding bg-white">
      <view class="flex flex-wrap">
        <view class="basis bg-{{color[index]}} margin-xs padding-sm radius text-center" wx:for="{{sem_list}}" wx:key="index" data-xnd="{{item.xnd}}" data-xqd="{{item.xqd}}" bindtap="getGradeDatail">
          {{item.xnd}}年第{{item.xqd}}学期
        </view>
      </view>
      <view style='color:grey;font-size:70%;margin:20rpx;text-align: center;'>成绩数据仅供参考，请以官网为准</view>
    </view>
  </view>
</template>
<!-- <block wx:if="{{!current_term && !hasGrade}}">
	<view>
		<template is="itemList" data="{{sem_list,color}}"/>
	</view>

</block> -->
<!-- 本学期成绩 -->
<block wx:if="{{hasGrade}}">
  <view class='page'>
    <view class='sum-grade'>
      <view style='flex:1'>
        {{grade.average_point}}
        <view class='bottom-text'>平均绩点</view>
      </view>
      <view style='flex:1'>
        {{grade.course_credit}}
        <view class='bottom-text'>总学分</view>
      </view>
    </view>
    <view wx:if="{{grade}}" style='height:{{height}}rpx'>
      <view wx:key="index">
        <view class='sem-cell'>
          <view style='height:250rpx'>
            <view style='color:gray;padding:15rpx;font-size:110%'>
              {{grade.xnd}}学年 第{{grade.xqd}}学期
            </view>
            <view class='sem-grade'>
              <view style='flex:1'>
                {{grade.general_course_credit+grade.electives_credit+grade.compulsory_course_credit}}
                <view class='bottom-text'>已修学分</view>
              </view>
              <view style='flex:1'>
                {{grade.average_point}}
                <view class='bottom-text'>学期绩点</view>
              </view>
            </view>
          </view>
          <!-- 课程成绩循环 -->
          <view class='grade-cell margin-tb-sm' style="background-color:{{flagColor[item.level]}};" wx:for="{{grade.score}}" wx:key="index">
            <view bindtap="showDetail" id="{{index}}">
              <view class='son-part part1'>
                <view style='flex:1.5;color:{{color[item.level]}};'>{{item.course}}</view>
                <view style='flex:1;color:{{color[item.level]}};'>{{item.grade}}</view>
              </view>
              <view class='son-part part2'>
                <view style='flex:1.5;color:{{color[item.level]}}'>学分：{{item.credit}}</view>
                <view style='flex:1;color:{{color[item.level]}}'>绩点：{{item.point}}</view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</block>
<!-- 提示弹窗 -->
<modal show="{{!current_term}}" title="未查到本学期成绩" confirmText="往年成绩" cancelText="返回" bind:cancel="navBack" bind:confirm="confirm">
  <view class="margin-lr-xl">
    <text class="text-gray" style='color:grey;font-size:70%;margin:20rpx'>成绩数据仅供参考，请以官网为准</text>
  </view>
</modal>
<drawer-modal show='{{showDrawer}}'>
  <view slot="left" catchtap="catchtap" class='dawer'>
    <template is="itemList" data="{{sem_list,color}}" />
  </view>
</drawer-modal>
<modal custom="true" show="{{showDetail}}" bind:cancel="cancelModal">
  <view style='height:580rpx'>
    <view>
      <view class='course' style='background-color:{{flagColor[detail.level]}}'>
        <view>{{detail.course}}（{{detail.course_type}}）</view>
      </view>
      <view style='padding:10rpx'>
        <view class='detail-item solid-top' wx:if="{{detail.credit!=null}}">
          <view class='key'>学分</view>
          <view class='value'>{{detail.credit}}</view>
        </view>
        <view class='detail-item solid-top'>
          <view class='key'>绩点</view>
          <view class='value'>{{detail.point}}</view>
        </view>
        <view class='detail-item solid-top'>
          <view class='key'>平时成绩</view>
          <view class='value'>{{detail.usual_grade}}</view>
        </view>
        <view class='detail-item solid' wx:if="{{detail.midterm_grade!=''}}">
          <view class='key'>期中考</view>
          <view class='value'>{{detail.midterm_grade}}</view>
        </view>
        <view class='detail-item solid-top'>
          <view class='key'>期末成绩</view>
          <view class='value'>{{detail.grade}}</view>
        </view>
        <view class='detail-item solid-top'>
          <view class='key'>总评成绩</view>
          <view class='value'>{{detail.grade}}</view>
        </view>
        <view class='detail-item solid-top' wx:if="{{detail.rebuild_course}}">
          <view class='key'>重修课</view>
          <view class='value'>{{detail.rebuild_course}}</view>
        </view>
      </view>
    </view>
  </view>
</modal>